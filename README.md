<a id="anchor"></a>
<h1 align="center"> Nicelight </h1>

## Контроллер для управления системами поддержания жизни.  
Содержит веб морду с гибкими настройками, отображением параметров окружающей среды и тонкого упралвения таймерами, реле с любыми подключаемыми устройствами.  
Прошивка основана на Гайверовской библиотеке Settings
Пока что на контроллере ESP32. Легко адаптируется под es8266.
Не стесняйтесь задавать любые вопросы в телеграм сообществе [Smartfarm_diy](https://t.me/smartfarm_diy)

![Веб морда для управления открывается в Chrome c телефона или компьютера](https://github.com/nicelight/minihub-pio/blob/main/pic/promo.png)

## Установка прошивки
### 1. Устанавливаем драйвер для связи компа и платы
Подключаем плату esp32 WROOM32 к компьютеру. При подключении должен быть характерный звук тынь-дынь, как будто флешку подключили. Если звука нет, кабель плохой, ищите более хороший. Или звук на компе отключен :) Если подключаете плату первый раз, нужно установить драйвер для связи компа с платой. Бывает [несколько типов драйверов](https://blog.spacehuhn.com/espcomm#heading-drivers) в зависимости от версии платы, которую вы используете. Для нашей WROOM32 обычно подходит драйвер [CP2102](https://www.silabs.com/documents/public/software/CP210x_Universal_Windows_Driver.zip) Если не подошел, перейдите по ссылке выше и по фоткам определите какая микросхема установлена на плате, под фоткой будет ссылка на скачивание драйверов. Скачиваем архив, распаковываем все файлы, нажимаем по файлу с именем в конце .inf правой кнопкой мыши - установить. Аналогично в папке x64 правой кнопкой мыши по файлу - установить. Теперь плата должна быть на связи с компьютером.

### 2. Прошиваем плату через сайт
В браузере гугл хром открываем сайт [esphome web](https://web.esphome.io/) 
Кнопка Connect откроет окно с выбором портов, там будет установленный прежде драйвер COM порта, выбираем его
![](https://github.com/nicelight/minihub-pio/blob/main/pic/esphome-1.png)

Есливыскакивает окно **"Подтвердите действие** Failed to execute ...", отключите плату от компьютера, обновите страницу, подключите плату и снова жмите Connect. 
Увидим окно подключенной платы. 
![ESP Подключена успешно](https://github.com/nicelight/minihub-pio/blob/main/pic/esphome-2.png)
Теперь настало время скачать прошивку. Свежие прошивки можно найти в [релизах](https://github.com/nicelight/Nicelight_cozyBeing/releases), на данный момент [скачиваем v0.1](https://github.com/nicelight/Nicelight_cozyBeing/releases/download/v0.1/firmware_full.bin), браузер может ругаться что мол опасный файл, нельзя такое качать. Постарайтесь его уговорить на скачку, мол download anyway. Скачиваем, запоминаем путь куда скачалась эта прошивка *firmware_full.bin*
Возвращаемся в браузере на страницу esphome web, Нажимаем на "Install" - "Выберите файл" - выбираем скачанный файл прошивки, снова жмем "Install". 
Ждем несколько минут, видим окошко с поздравлением, что прошивка прошла успешно.
жмем Close. Плата начнет часто мигать синим по два раза.
Теперь , если хотите, скачайте [приложение Гайвера](https://github.com/GyverLibs/Settings-discover/releases/latest/download/Settings.apk) для связи с платой.
я не люблю лишних приложений, поэтому заходу на плату по ip адресу упралвляю ей с браузера. Для этого после прошивки на сайте esphome жмем Logs. Откроется монитор серийного порта такой же как в ардуино иде. 
Перезагрузите плату кнопкой EN на плате. Появится вайфай точка доступа "ESP AP" пароль 12345678. Подключайтесь с любого устройства и заходите в браузере по адресу 192.168.4.1 Если подключиться с телефона, этот адрес откроется автоматически. И вот мы внутри контроллера.

<details>
    <summary>Альтернативный вариант</summary>
Так же прошить плату можно на  [esp huhn](https://esp.huhn.me/).
 Жмем зеленую кнопку Connect. Всплывает маленькое окно с выбором нашей платы из списка. В списке отобразятся все подключенные к компу платы на данный момент, но обчно она там одна. У меня это CP2102, выбираем - Connect. Плата связана с прошивальщиком. 
![подключаем ](https://github.com/nicelight/minihub-pio/blob/main/pic/web-connect.png)

Если пишет Connecting и ничего не происходит, отключите плату от компьютера, обновите страницу, подключите плату и снова жмите зеленую кнопку. Успешным подключением будет окно с 4мя строчками:

![подключились ](https://github.com/nicelight/minihub-pio/blob/main/pic/connected.png)

Прошивку добавляем, адрес выставляем 0x0000. нажимаем Flash 
</details>

## Использование контроллера
Подключившись к wifi точке доступа "ESP AP" либо автоматически откроется сайт, либо введите в браузере 192.168.4.1 и мы попадаем на веб страницу управления. Листаем в самый низ - Опции - Расширенные - вводим SSID и пароль вашей домашней wifi сети жмем зеленую "Save Restart" после чего плата должна перестать часто мигать, а через какое то время начнет редко мигать, раз в три секунды. Это значит что она подключена к домашнему wifi. 
После этого можно снова подключиться на сайте  [esphome web](https://web.esphome.io/) через usb шнур и нажать Logs. Появится черное окно, ищите что то типа: 
Con with IP: 192.168.1.224 
Если не появилось, перезагрузите плату кнопкой EN.
192.168.1.224 это айпишник веб интерфейса управления платой в вашей домашней вайфай сети. 

## Подключение датчиков и реле
Чтобы к контроллеру подключить датчики и реле, удобно использовать: "Плата расширения Wroom32", легко найти ее на Озоне или Алиэкспресс.

Если вы новичек, почитайте [Гайвер управление мощной нагрузкой](https://alexgyver.ru/lessons/arduino-load/)

- Слабенькие, [классические реле](https://aliexpress.ru/item/1005004518817573.html?sku_id=12000029449327898&spm=a2g2w.productlist.search_results.11.53cb2b22e7yxCY) кстати те, что двойные, удачно ложатся в кабель канал как в корпус. 
- драйверы на постоянку [до 24V LR7843 или до 48V FR120N](https://aliexpress.ru/item/1005006448068330.html?spm=a2g2w.detail.similar_rcmd.0.956d7666MK8vx5&mixer_rcmd_bucket_id=aerabtestalgoRecommendAbV2_testMatrixFiltrationPromo&pdp_trigger_item_id=0_1005007641232521&ru_algo_pv_id=3c6484-61b690-8503e6-6b46e9-1733893200&scenario=aerSimilarItemPdpRcmd&sku_id=12000037205310095&traffic_source=recommendation&type_rcmd=core)

Управление 220 вольт:
- [симмисторы](https://aliexpress.ru/item/32782647579.html?spm=a2g2w.detail.similar_rcmd.11.604229ea5HvSRg&mixer_rcmd_bucket_id=aerabtestalgoRecommendAbV2_controlRu1&pdp_trigger_item_id=0_1005008080925985&ru_algo_pv_id=3c6484-61b690-22faee-d47566-1736254800&scenario=aerSimilarItemPdpRcmd&sku_id=12000018624201677&traffic_source=recommendation&type_rcmd=core)
- [твердотелки детские, слабенькие](https://aliexpress.ru/item/32729232411.html?spm=a2g2w.detail.%20rcmdprod.14.6641ad2dOMUQr2&mixer_rcmd_bucket_id=aerabtestalgoRecommendAbV2_controlRu1&ru_algo_pv_id=3c6484-65a512-200ff8-9725ba-1736254800&scenario=aerAppJustForYouNew&sku_id=12000037978111457&traffic_source=recommendation&type_rcmd=core)
- [твердотелки нормальные](https://aliexpress.ru/item/1005006953580553.html?sku_id=12000038839618236&spm=a2g2w.productlist.search_results.1.b2f335b9Yx1aCW)


nicelight/Nicelight_cozyBeing